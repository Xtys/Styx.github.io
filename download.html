<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="download.css">
  <title>Download Mods</title>
</head>
<body>
  <div class="download-page">
    <h2>Available Mods</h2>
    <div class="file-container">
      <!-- Button for Ako Tamaki download -->
      <button onclick="handleDownload('ako_tamaki_v2.3')">Download Ako Tamaki v2.3</button>
      <span id="count-ako">Downloads: 0</span>
      <br>
      <!-- Button for Kurisu Makise download -->
      <button onclick="handleDownload('kurisu_makise_v1.3')">Download Kurisu Makise v1.3</button>
      <span id="count-kurisu">Downloads: 0</span>
    </div>
  </div>

  <script>
    function updateDownloadCounter(fileKey, callback) {
        fetch('downloadcounter.php?file=' + fileKey)
            .then(response => response.json())
            .then(data => {
                console.log('Download count updated:', data.newCount);
                document.getElementById(`count-${fileKey}`).textContent = 'Downloads: ' + data.newCount;
                if (callback) callback();
            })
            .catch(error => console.error('Error updating counter:', error));
    }

    function downloadFile(fileKey) {
        fetch('download.php?file=' + fileKey)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok.');
                }
                return response.blob();
            })
            .then(blob => {
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.style.display = 'none';
                a.href = url;
                a.download = fileKey + '.zip';
                document.body.appendChild(a);
                a.click();
                window.URL.revokeObjectURL(url);
            })
            .catch(error => {
                console.error('Error downloading the file:', error);
            });
    }

    function handleDownload(fileKey) {
        updateDownloadCounter(fileKey, () => downloadFile(fileKey));
    }

    // Fetch and update download counts on page load
    function fetchDownloadCounts() {
        fetch('get_counts.php')
            .then(response => response.json())
            .then(counts => {
                document.getElementById('count-ako').textContent = 'Downloads: ' + (counts['ako_tamaki_v2.3'] || 0);
                document.getElementById('count-kurisu').textContent = 'Downloads: ' + (counts['kurisu_makise_v1.3'] || 0);
            })
            .catch(error => console.error('Error fetching counts:', error));
    }

    // Initialize download counts on page load
    fetchDownloadCounts();
  </script>
</body>
</html>
